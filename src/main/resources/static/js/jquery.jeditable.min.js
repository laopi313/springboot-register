(function($){$.fn.editable=function(a,b){var c={target:a,name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}};b&&$.extend(c,b);var d=$.editable.types[c.type].plugin||function(){},f=$.editable.types[c.type].submit||function(){},g=$.editable.types[c.type].buttons||$.editable.types.defaults.buttons,h=$.editable.types[c.type].content||$.editable.types.defaults.content,i=$.editable.types[c.type].element||$.editable.types.defaults.element,j=$.editable.types[c.type].reset||$.editable.types.defaults.reset,k=c.callback||function(){},l=c.onsubmit||function(){},m=c.onreset||function(){},n=c.onerror||j;return $.isFunction($(this)[c.event])||($.fn[c.event]=function(a){return a?this.bind(c.event,a):this.trigger(c.event)}),$(this).attr("title",c.tooltip),c.autowidth="auto"==c.width,c.autoheight="auto"==c.height,this.each(function(){var a=this,b=$(a).width(),e=$(a).height();$.trim($(this).html())||$(this).html(c.placeholder),$(this)[c.event](function(){if(!a.editing){$(a).removeAttr("title"),0==$(a).width()?(c.width=b,c.height=e):("none"!=c.width&&(c.width=c.autowidth?b:c.width),"none"!=c.height&&(c.height=c.autoheight?$(a).height():c.height)),$(this).html().toLowerCase().replace(/;/,"")==c.placeholder.toLowerCase().replace(/;/,"")&&$(this).html(""),a.editing=!0,a.revert=$(a).html(),$(a).html("");var m=$("<form />");c.cssclass&&("inherit"==c.cssclass?m.attr("class",$(a).attr("class")):m.attr("class",c.cssclass)),c.style&&("inherit"==c.style?(m.attr("style",$(a).attr("style")),m.css("display",$(a).css("display"))):m.attr("style",c.style));var o,p=i.apply(m,[c,a]);if(c.loadurl){var q=setTimeout(function(){p.disabled=!0,h.apply(m,[c.loadtext,c,a])},100),r={};r[c.id]=a.id,$.isFunction(c.loaddata)?$.extend(r,c.loaddata.apply(a,[a.revert,c])):$.extend(r,c.loaddata),$.ajax({type:c.loadtype,url:c.loadurl,data:r,async:!1,success:function(a){window.clearTimeout(q),o=a,p.disabled=!1}})}else c.data?(o=c.data,$.isFunction(c.data)&&(o=c.data.apply(a,[a.revert,c]))):o=a.revert;h.apply(m,[o,c,a]),p.attr("name",c.name),g.apply(m,[c,a]),$(a).append(m),d.apply(m,[c,a]),$(":input:visible:enabled:first",m).focus(),c.select&&p.select(),p.keydown(function(b){27==b.keyCode&&(b.preventDefault(),j.apply(m,[c,a]))});var q;"cancel"==c.onblur?p.blur(function(){q=setTimeout(function(){j.apply(m,[c,a])},500)}):"submit"==c.onblur?p.blur(function(){q=setTimeout(function(){m.submit()},200)}):$.isFunction(c.onblur)?p.blur(function(){c.onblur.apply(a,[p.val(),c])}):p.blur(function(){}),m.submit(function(b){if(q&&clearTimeout(q),b.preventDefault(),!1!==l.apply(m,[c,a])&&!1!==f.apply(m,[c,a]))if($.isFunction(c.target)){var d=c.target.apply(a,[p.val(),c]);$(a).html(d),a.editing=!1,k.apply(a,[a.innerHTML,c]),$.trim($(a).html())||$(a).html(c.placeholder)}else{var e={};e[c.name]=p.val(),e[c.id]=a.id,$.isFunction(c.submitdata)?$.extend(e,c.submitdata.apply(a,[a.revert,c])):$.extend(e,c.submitdata),"PUT"==c.method&&(e._method="put"),$(a).html(c.indicator);var g={type:"POST",data:e,url:c.target,success:function(b){$(a).html(b),a.editing=!1,k.apply(a,[a.innerHTML,c]),$.trim($(a).html())||$(a).html(c.placeholder)},error:function(b){n.apply(m,[c,a,b])}};$.extend(g,c.ajaxoptions),$.ajax(g)}return $(a).attr("title",c.tooltip),!1})}}),this.reset=function(b){this.editing&&!1!==m.apply(b,[c,a])&&($(a).html(a.revert),a.editing=!1,!$.trim($(a).html())&&$(a).html(c.placeholder),$(a).attr("title",c.tooltip))}})},$.editable={types:{defaults:{element:function(){var a=$("<input type=\"hidden\"></input>");return $(this).append(a),a},content:function(a){$(":input:first",this).val(a)},reset:function(a,b){b.reset(this)},buttons:function(a,b){var c=this;if(a.submit){if(a.submit.match(/>$/))var d=$(a.submit).click(function(){"submit"!=d.attr("type")&&c.submit()});else{var d=$("<button type=\"submit\" />");d.html(a.submit)}$(this).append(d)}if(a.cancel){if(a.cancel.match(/>$/))var e=$(a.cancel);else{var e=$("<button type=\"cancel\" />");e.html(a.cancel)}$(this).append(e),$(e).click(function(){if($.isFunction($.editable.types[a.type].reset))var d=$.editable.types[a.type].reset;else var d=$.editable.types.defaults.reset;return d.apply(c,[a,b]),!1})}}},text:{element:function(a){var b=$("<input />");return"none"!=a.width&&b.width(a.width),"none"!=a.height&&b.height(a.height),b.attr("autocomplete","off"),$(this).append(b),b}},textarea:{element:function(a){var b=$("<textarea />");return a.rows?b.attr("rows",a.rows):b.height(a.height),a.cols?b.attr("cols",a.cols):b.width(a.width),$(this).append(b),b}},select:{element:function(){var a=$("<select />");return $(this).append(a),a},content:function(string,settings,original){if(String==string.constructor)for(var key in eval("var json = "+string),json)if(json.hasOwnProperty(key)&&"selected"!=key){var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){($(this).val()==json.selected||$(this).text()==original.revert)&&$(this).attr("selected","selected")})}}},addInputType:function(a,b){$.editable.types[a]=b}}})(jQuery);